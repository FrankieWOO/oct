<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of test_lspi_lqr_ih_d</title>
  <meta name="keywords" content="test_lspi_lqr_ih_d">
  <meta name="description" content="Demo script: Test LSPI solution of infinite horizon linear-quadratic regulator problem in discrete time.">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../index.html">Home</a> &gt;  <a href="#">examples</a> &gt; test_lspi_lqr_ih_d.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../index.html"><img alt="<" border="0" src="../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for .\examples&nbsp;<img alt=">" border="0" src="../right.png"></a></td></tr></table>-->

<h1>test_lspi_lqr_ih_d
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>Demo script: Test LSPI solution of infinite horizon linear-quadratic regulator problem in discrete time.</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>This is a script file. </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment"> Demo script: Test LSPI solution of infinite horizon linear-quadratic regulator problem in discrete time.</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="../control/pi_linear.html" class="code" title="function u = pi_linear ( x, L )">pi_linear</a>	Linear policy</li><li><a href="../cost/l_quadratic.html" class="code" title="function l = l_quadratic ( x, u, p )">l_quadratic</a>	Finite horizon quadratic cost function.</li><li><a href="../dynamics/f/f_linear_d.html" class="code" title="function x = f_linear_d ( x, u, model )">f_linear_d</a>	Linear dynamics function in discrete time</li><li><a href="../dynamics/f/f_linear_d.html" class="code" title="function x = f_linear_d ( x, u, model )">f_linear_d</a>	Linear dynamics function in discrete time</li><li><a href="../lqr/lqr_ih_d.html" class="code" title="function [pi,L,S] = lqr_ih_d(A, B, Q, R)">lqr_ih_d</a>	Solve Riccati equation and compute optimal gains for infinite horizon linear-quadratic regulator problem in discrete time.</li><li><a href="../lspi/lspi.html" class="code" title="function [ pi, Q, model ] = lspi ( D, pi0, model, argmaxuQ, gamma, p );">lspi</a>	Function for solving (infinite horizon) optimal control problems with the Least Squares Policy Iteration method.</li><li><a href="../lspi/rand_interval.html" class="code" title="function r=rand_interval(N,M,rmax,rmin)">rand_interval</a>	</li><li><a href="../plot/plot_lq_fh.html" class="code" title="function h = plot_lq_fh(figNo,figName,t,x,u,L,xh,colour)">plot_lq_fh</a>	Function for plotting solutions to the finite horizon LQ problem from the demo scripts</li><li><a href="../simulate/simulate_feedback_d.html" class="code" title="function [x,u] = simulate_feedback_d ( x0, f, pi, p )">simulate_feedback_d</a>	Simulate trajectory under closed-loop feedback control, in discrete time</li><li><a href="../value/evaluate_trajectory_cost_ih_d.html" class="code" title="function cost = evaluate_trajectory_cost_ih_d ( x, u, l, gamma )">evaluate_trajectory_cost_ih_d</a>	Function for evaluating the cost along a trajectory under a given cost function in discrete time</li><li><a href="../value/q/argmaxuq/argmaxuQ_phi_lqrq.html" class="code" title="function [pi, L] = argmaxuQ_phi_lqrq ( theta )">argmaxuQ_phi_lqrq</a>	Function for calculating argmax_u (Q) from the weights of the Q-function for the LQR problem.</li><li><a href="../value/q/argmaxuq/argmaxuQ_phi_lqrq.html" class="code" title="function [pi, L] = argmaxuQ_phi_lqrq ( theta )">argmaxuQ_phi_lqrq</a>	Function for calculating argmax_u (Q) from the weights of the Q-function for the LQR problem.</li><li><a href="../value/q/argmaxuq/argmaxuQ_phi_lqrq.html" class="code" title="function [pi, L] = argmaxuQ_phi_lqrq ( theta )">argmaxuQ_phi_lqrq</a>	Function for calculating argmax_u (Q) from the weights of the Q-function for the LQR problem.</li><li><a href="../value/q/basisfns/phi_lqrq.html" class="code" title="function phi = phi_lqrq ( x, u )">phi_lqrq</a>	Polynomial basis function for use on the 1-D LQR problem with linear function approximation fitting of Q.</li><li><a href="../value/q/basisfns/phi_lqrq.html" class="code" title="function phi = phi_lqrq ( x, u )">phi_lqrq</a>	Polynomial basis function for use on the 1-D LQR problem with linear function approximation fitting of Q.</li><li><a href="../value/q/basisfns/phi_lqrq.html" class="code" title="function phi = phi_lqrq ( x, u )">phi_lqrq</a>	Polynomial basis function for use on the 1-D LQR problem with linear function approximation fitting of Q.</li></ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
</ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 <span class="comment">% Demo script: Test LSPI solution of infinite horizon linear-quadratic regulator problem in discrete time.</span>
0002 
0003 clear all;
0004 rand(<span class="string">'seed'</span>,1),randn(<span class="string">'seed'</span>,1)
0005 datafile = [<span class="string">'D_'</span>,mfilename,<span class="string">'.mat'</span>];
0006 <span class="keyword">if</span> 1,unix([<span class="string">'rm -f '</span>,datafile]);<span class="keyword">end</span> <span class="comment">% remove old data if needed</span>
0007 
0008 <span class="comment">% set up numerical simulation</span>
0009 dt = 0.02;       <span class="comment">% time step</span>
0010 N  = 200;        <span class="comment">% number of time steps</span>
0011 t  = (0:N-1)*dt; <span class="comment">% sample times</span>
0012 
0013 <span class="comment">% simulation parameters</span>
0014 ps = []; ps.N = N;
0015 
0016 <span class="comment">% dimensionality</span>
0017 dimX = 2;
0018 dimU = 1;
0019 dimY = dimX;
0020 
0021 <span class="comment">% start state</span>
0022 x0 = [1;0];
0023 
0024 <span class="comment">% dynamics</span>
0025 model.A = [ 1 dt ; <span class="keyword">...</span>
0026             0  1 ];
0027 model.B = [ 0 ; <span class="keyword">...</span>
0028            dt ];
0029 f = @(x, u) <a href="../dynamics/f/f_linear_d.html" class="code" title="function x = f_linear_d ( x, u, model )">f_linear_d</a> ( x, u, model );         <span class="comment">% linear dynamics (discrete time)</span>
0030 
0031 <span class="comment">% sensor</span>
0032 h = @(x)x;
0033 
0034 <span class="comment">% cost</span>
0035 pc = [];
0036 <span class="comment">% state cost</span>
0037 pc.Q  = dt*[1  0;  0  0.1];
0038 <span class="comment">% command cost</span>
0039 pc.R  = dt*.1;
0040 l  = @(x,u) <a href="../cost/l_quadratic.html" class="code" title="function l = l_quadratic ( x, u, p )">l_quadratic</a> ( x, u, pc ); <span class="comment">% quadratic costs</span>
0041 
0042 <span class="comment">% get training data</span>
0043 <span class="keyword">try</span>   <span class="comment">% load data, if possible</span>
0044 load(datafile);
0045 <span class="keyword">catch</span> <span class="comment">% otherwise, regenerate</span>
0046 <span class="comment">% generate training data</span>
0047 xmax = 1.1*ones(dimX,1); xmin=-xmax; umax = 10; umin = -umax; <span class="comment">% range of data</span>
0048 Ntr = 6;                                        <span class="comment">% no. data points</span>
0049 X  = nan(dimX,Ntr);<span class="keyword">for</span> i=1:dimX,X(i,:) = <a href="../lspi/rand_interval.html" class="code" title="function r=rand_interval(N,M,rmax,rmin)">rand_interval</a>(1,Ntr,xmax(i),xmin(i));<span class="keyword">end</span>
0050 U  = nan(dimU,Ntr);<span class="keyword">for</span> i=1:dimU,U(i,:) = <a href="../lspi/rand_interval.html" class="code" title="function r=rand_interval(N,M,rmax,rmin)">rand_interval</a>(1,Ntr,umax(i),umin(i));<span class="keyword">end</span>
0051 Xn = nan(dimX,Ntr);
0052 RR = nan(   1,Ntr);
0053 <span class="keyword">for</span> n=1:Ntr
0054 Xn(:,n)=  f(X(:,n),U(:,n));
0055 RR(:,n)= -l(X(:,n),U(:,n));
0056 <span class="keyword">end</span>
0057 Y  = h(X );
0058 Yn = h(Xn);
0059 D.X = X; D.Y = Y; D.R = RR; D.Xn = Xn; D.U = U; D.Yn = Yn;
0060 <span class="comment">% save data</span>
0061 save(datafile,<span class="string">'D'</span>);
0062 <span class="keyword">end</span>
0063 <span class="comment">% unpack data</span>
0064 Ntr = size(D.X,2);
0065 fprintf(1,<span class="string">'#Data: %5d, '</span>,Ntr);   
0066 
0067 <span class="comment">% set up LSPI parameters, functions</span>
0068 gamma      = 1; <span class="comment">% discount factor</span>
0069 p          = [];
0070 model.phi  = @(z)<a href="../value/q/basisfns/phi_lqrq.html" class="code" title="function phi = phi_lqrq ( x, u )">phi_lqrq</a>(z(1:dimX,:),z(dimX+1:<span class="keyword">end</span>,:)); <span class="comment">% basis functions</span>
0071 argmaxuQ   = @(theta)<a href="../value/q/argmaxuq/argmaxuQ_phi_lqrq.html" class="code" title="function [pi, L] = argmaxuQ_phi_lqrq ( theta )">argmaxuQ_phi_lqrq</a>(theta); <span class="comment">% function for finding the argmax of the Q-function</span>
0072 pi0        = @(x)<a href="../control/pi_linear.html" class="code" title="function u = pi_linear ( x, L )">pi_linear</a>(x,[1,1]);        <span class="comment">% initial policy</span>
0073 
0074 <span class="comment">% optimise</span>
0075 [pi, Qp, model] = <a href="../lspi/lspi.html" class="code" title="function [ pi, Q, model ] = lspi ( D, pi0, model, argmaxuQ, gamma, p );">lspi</a>( D, pi0, model, argmaxuQ, gamma, p );
0076 
0077 <span class="comment">% estimate cost from computed Q function</span>
0078 costp = Qp(x0,pi(x0));
0079 fprintf(1,<span class="string">'Predicted cost from x0    = %f\n'</span>,costp)
0080 
0081 <span class="comment">% run controller on plant</span>
0082 [x,u] = <a href="../simulate/simulate_feedback_d.html" class="code" title="function [x,u] = simulate_feedback_d ( x0, f, pi, p )">simulate_feedback_d</a>(x0,f,pi,ps);
0083 
0084 <span class="comment">% evaluate cost of trajectory on plant</span>
0085 cost = <a href="../value/evaluate_trajectory_cost_ih_d.html" class="code" title="function cost = evaluate_trajectory_cost_ih_d ( x, u, l, gamma )">evaluate_trajectory_cost_ih_d</a>(x,u,l,1);
0086 fprintf(1,<span class="string">'Cost (evaluated on plant) = %f\n'</span>,cost)
0087 
0088 <span class="comment">% evaluate error in solution (compared to analytical)</span>
0089 [dummy,L]= argmaxuQ(model.w); <span class="comment">% get gains (for evaluating errors)</span>
0090 [pit,Lt,Vt] = <a href="../lqr/lqr_ih_d.html" class="code" title="function [pi,L,S] = lqr_ih_d(A, B, Q, R)">lqr_ih_d</a>(model.A, model.B, pc.Q, pc.R); <span class="comment">% optimise policy numerically</span>
0091 [xt,ut] = <a href="../simulate/simulate_feedback_d.html" class="code" title="function [x,u] = simulate_feedback_d ( x0, f, pi, p )">simulate_feedback_d</a> ( x0, f, pit, ps );
0092 Nx=min(size(x,2),size(xt,2)); RMSE_x=sqrt(sum((xt(:,1:Nx)-x(:,1:Nx)).^2,2)/Nx);
0093 Nu=min(size(u,2),size(ut,2)); RMSE_u=sqrt(sum((ut(:,1:Nu)-u(:,1:Nu)).^2,2)/Nu);
0094                               RMSE_L=norm(L-Lt);
0095 fprintf(1,<span class="string">'RMSE(x,x*)=[%f %f],RMSE(u,u*)=%f,||L-L*||=%f\n'</span>,RMSE_x,RMSE_u,RMSE_L)
0096 
0097 <span class="comment">% plot</span>
0098 fn=1;figure(fn),clf
0099 <a href="../plot/plot_lq_fh.html" class="code" title="function h = plot_lq_fh(figNo,figName,t,x,u,L,xh,colour)">plot_lq_fh</a>(fn,<span class="string">'LSPI/LQR-IH (discrete time)'</span>,t,x,u,[],[],<span class="string">'b'</span>);
0100 
0101 subplot(2,4,[1 2 5 6])
0102 
0103 <span class="comment">% plot out data points</span>
0104 plot3(D.X(1,:),D.X(2,:),D.U,<span class="string">'x'</span>,<span class="string">'Color'</span>,.9*ones(1,3))
0105 
0106 <span class="comment">% plot optimal V-function</span>
0107 Ngp=50; [X1,X2]=meshgrid(linspace(xmin(1),xmax(1),Ngp),linspace(xmin(2),xmax(2),Ngp)); 
0108 contour(X1,X2,reshape(Qp([X1(:),X2(:)]',pi([X1(:),X2(:)]')),Ngp,Ngp))
0109 
0110 xlim([xmin(1),xmax(1)])
0111 ylim([xmin(2),xmax(2)])
0112 zlim([umin(1),umax(1)])
0113 
0114 <span class="comment">% plot Q-function</span>
0115 subplot(2,4,8)
0116 Ngp=10; [X1,X2,U]=meshgrid(linspace(xmin(1),xmax(1),Ngp),linspace(xmin(2),xmax(2),Ngp),linspace(umin(1),umax(1),Ngp)); Z=[X1(:),X2(:),U(:)]';
0117 scatter3(Z(1,:),Z(2,:),Z(3,:),200*ones(1,size(Z,2)),Qp([Z(1,:);Z(2,:)],Z(3,:)),<span class="string">'.'</span>)
0118 xlabel(<span class="string">'x_1'</span>)
0119 ylabel(<span class="string">'x_2'</span>)
0120 zlabel(<span class="string">'u'</span>)
0121 
0122</pre></div>
<hr><address>Generated on Thu 11-Feb-2016 17:34:06 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>